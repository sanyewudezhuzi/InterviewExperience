# Redis



1.   Redis为什么快

>   1.   Redis是纯内存操作，C语言编写
>   2.   Redis是单线程操作
>   3.   数据简单，数据操作也相对简单
>   4.   Redis采用epoll作为I/O多路复用技术的实现



2.   RDB

>   什么是RDB？
>
>   *   RDB全称Redis Database Backup file，是Redis数据备份文件，也被称为Redis数据快照，用于将当前内存中的数据记录到磁盘中，记录的是二进制数据并进行压缩
>
>   什么时候会执行RDB？
>
>   1.   手动执行
>        *   save：会阻塞主进程
>        *   bgsave：后台执行
>   2.   Redis停机时执行
>   3.   触发设定的RDB条件
>        *   save 300 10：表示300秒内如果有10个key被修改就执行
>
>   RDB写时复制？
>
>   *   后台执行RDB时会通过Linux的fork函数复制主进程的信息得到子进程，它会有与主进程相同的指针指向内存中的数据页，子进程就通过指针读取内存数据写入RDB文件
>   *   由于主进程和子进程都可以获取这份数据，也就是说这份数据是共享的
>   *   当主进程执行读操作时，直接访问共享内存
>   *   当主进程执行写操作时，就会拷贝一份对应的数据执行写操作，完成写操作后数据页指向旧数据的指针就会指向新的数据
>   *   当RDB执行完后，操作系统就会回收那些没有被引用的数据



3.   AOF

>   什么是AOF？
>
>   *   AOF全称Append Only File，是追加文件。Redis处理的每一个写命令都会记录在AOF文件，记录的是命令。
>
>   AOF的同步频率？
>
>   *   Always：同步刷盘，可靠性高，几乎不丢失数据，但是性能消耗大
>   *   everysec：每秒刷盘，性能适中，最多会丢失一秒的数据
>   *   no：操作系统控制刷盘，性能最好，但是可靠性差，可能会丢失大量数据
>
>   AOF的文件重写：
>
>   *   因为一个key可能会产生多次的写操作，但只有最后一次的写操作才有意义，因此AOF文件重写能够读取内存然后对每个key生成一条写操作记录到AOF文件中
>   *   可以通过bgrewriteaof命令开启AOF文件重写，Redis也会在触发我们设定的重写条件时进行重写，例如增长超过多少百分比、文件体积到达多大



4.   RDB与AOF对比

>   RDB和AOF各有自己的优缺点，如果对数据安全性要求较高，在实际开发中往往会结合两者来使用
>
>   |                | RDB                                  | AOF                                                        |
>   | -------------- | ------------------------------------ | ---------------------------------------------------------- |
>   | 持久化方式     | 定时对整个内存做快照                 | 记录每一次执行的命令                                       |
>   | 数据完整性     | 不完整，两次备份之间数据会丢失       | 相对完整，取决于同步频率                                   |
>   | 文件大小       | 相对较小，记录二进制文件并压缩       | 相对较大，记录的是每条数据的命令                           |
>   | 宕机恢复速度   | 很快                                 | 慢                                                         |
>   | 数据恢复优先级 | 数据完整性不如AOF，优先级低          | 数据完整性较好，优先级高                                   |
>   | 系统资源占用   | 消耗大量CPU和内存，资源占用高        | 主要是磁盘IO，消耗低，但AOF文件重写依旧会占用大量CPU和内存 |
>   | 使用场景       | 可用容忍部分数据丢失，追求执行速度快 | 对数据安全性要求较高                                       |